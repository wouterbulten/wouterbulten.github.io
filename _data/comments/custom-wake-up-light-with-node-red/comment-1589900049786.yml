_id: 9829ed30-99e0-11ea-ab2b-99a85786333f
replying_to: '1589898840'
slug: custom-wake-up-light-with-node-red
name: Wouter Bulten
email: 95be418a0d147888e2ba0f2ad7c1f4b2
message: "My solution is a bit different. I would propose to use a function node to build a new data object and pass that to a node that turns on the light. Note: your light must support receiving both brightness and color temp at the same time.\r\n\r\nThe flow would be something like:\r\n\r\n1. `current_state` node to get brightness and color temp\r\n3. `function` node (see below)\r\n4. `call_service` node to turn on the light\r\n\r\nThen your function node can be:\r\n \r\n```js\r\nreturn {\r\n    payload: {\r\n        data: {\r\n            \"brightness\": msg.data.attributes.brightness + 10, // Compute it here\r\n            \"color_temp\": msg.data.attributes.color_temp - 10, // Compute it here\r\n        }\r\n    }\r\n};\r\n```\r\n\r\nHere is a flow you can start with (tested with a Hue bulb):\r\n\r\n```json\r\n[{\"id\":\"cd30ffc0.296fc\",\"type\":\"api-current-state\",\"z\":\"c0765167.cd327\",\"name\":\"\",\"version\":1,\"outputs\":1,\"halt_if\":\"\",\"halt_if_type\":\"str\",\"halt_if_compare\":\"is\",\"override_topic\":false,\"entity_id\":\"light.hue_spot_1\",\"state_type\":\"str\",\"state_location\":\"payload\",\"override_payload\":\"msg\",\"entity_location\":\"data\",\"override_data\":\"msg\",\"blockInputOverrides\":false,\"x\":230,\"y\":280,\"wires\":[[\"2d9c3721.d25148\"]]},{\"id\":\"899c5b7a.0226c8\",\"type\":\"inject\",\"z\":\"c0765167.cd327\",\"name\":\"\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"onceDelay\":0.1,\"x\":140,\"y\":220,\"wires\":[[\"cd30ffc0.296fc\"]]},{\"id\":\"2d9c3721.d25148\",\"type\":\"function\",\"z\":\"c0765167.cd327\",\"name\":\"\",\"func\":\"return {\\n    payload: {\\n        data: {\\n            \\\"brightness\\\": msg.data.attributes.brightness + 10, // Compute it here\\n            \\\"color_temp\\\": msg.data.attributes.color_temp - 10, // Compute it here\\n        }\\n    }\\n};\",\"outputs\":1,\"noerr\":0,\"x\":430,\"y\":280,\"wires\":[[\"a261b972.905a48\",\"40ba0325.61110c\"]]},{\"id\":\"a261b972.905a48\",\"type\":\"debug\",\"z\":\"c0765167.cd327\",\"name\":\"\",\"active\":true,\"tosidebar\":true,\"console\":false,\"tostatus\":false,\"complete\":\"false\",\"x\":590,\"y\":280,\"wires\":[]},{\"id\":\"40ba0325.61110c\",\"type\":\"api-call-service\",\"z\":\"c0765167.cd327\",\"name\":\"\",\"version\":1,\"service_domain\":\"light\",\"service\":\"turn_on\",\"entityId\":\"light.hue_spot_1\",\"data\":\"\",\"dataType\":\"json\",\"mergecontext\":\"\",\"output_location\":\"\",\"output_location_type\":\"none\",\"mustacheAltTags\":false,\"x\":610,\"y\":320,\"wires\":[[]]}]\r\n```"
id: 1589900049
date: '2020-05-19T14:54:09.784Z'
